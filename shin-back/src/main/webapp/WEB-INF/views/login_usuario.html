<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
  <meta http-equiv="x-ua-compatible" content="ie=edge"/>
  <title>Inicia sesión | Shing Shing</title>
  <!-- Favicon -->
  <link rel="shortcut icon" th:href="@{/resources/home/img/brands/favicon.png}" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"/>
  <!-- Bootstrap core CSS -->
  <link th:href="@{/resources/home/css/bootstrap.min.css}" rel="stylesheet"/>
  <!-- Material Design Bootstrap -->
  <link th:href="@{/resources/home/css/mdb.min.css}" rel="stylesheet"/>
  <!-- Your custom styles (optional) -->
  <link th:href="@{/resources/home/css/style.css}" rel="stylesheet"/>
  <!-- Your custom styles (optional) -->
  <link th:href="@{/resources/home/css/login.css}" rel="stylesheet"/>
  <!-- Font -->
  <link href="https://fonts.googleapis.com/css?family=Nunito:300,300i,700,900&;display=swap" rel="stylesheet"/>
  <script src="https://apis.google.com/js/api:client.js"></script>


<script>


 
 function LoginFacebook(){
	  
	  FB.login(function (response){

		  if(response.status =='connected'){

		 // person.userID = response.authReponse.userID;
		
		  FB.api('/me?fields=id,name,first_name, last_name,email, picture.type(large)', function(userData){
			  //person.name=userData.name;
			  //person.email=userData.email;
			  //person.picture=userData.picture.data.url;
			  console.log(userData)
			  validateSocialMediaUser(userData);
			  });
		  }
	  })
  }
</script>

	<script>
	function statusChangeCallback(response) {  // Called with the results from FB.getLoginStatus().
	    console.log('statusChangeCallback');
	    console.log(response);                   // The current login status of the person.
	    if (response.status === 'connected') {   // Logged into your webpage and Facebook.
	      testAPI();  
	    } else {                                 // Not logged into your webpage or we are unable to tell.
	      document.getElementById('status').innerHTML = 'Please log ' +
	        'into this webpage.';
	    }
	  }


	  function checkLoginState() {               // Called when a person is finished with the Login Button.
	    FB.getLoginStatus(function(response) {   // See the onlogin handler
	      statusChangeCallback(response);
	    });
	  }


	  window.fbAsyncInit = function() {
	    FB.init({
	    appId      : '576243033099558',
	      //appId      : '480515842728115',appId anterior
	      cookie     : true,                     // Enable cookies to allow the server to access the session.
	      xfbml      : true,                     // Parse social plugins on this webpage.
	      version    : 'v6.0'           // Use this Graph API version for this call.
	    });


	    FB.getLoginStatus(function(response) {   // Called after the JS SDK has been initialized.
	      statusChangeCallback(response);        // Returns the login status.
	    });
	  };

	  
	  (function(d, s, id) {                      // Load the SDK asynchronously
	    var js, fjs = d.getElementsByTagName(s)[0];
	    if (d.getElementById(id)) return;
	    js = d.createElement(s); js.id = id;
	    js.src = "https://connect.facebook.net/en_US/sdk.js";
	    fjs.parentNode.insertBefore(js, fjs);
	  }(document, 'script', 'facebook-jssdk'));

	 
	  function testAPI() {                      // Testing Graph API after login.  See statusChangeCallback() for when this call is made.
	    console.log('Welcome!  Fetching your information.... ');
	    FB.api('/me', function(response) {
	      console.log('Successful login for: ' + response.name);
	      document.getElementById('status').innerHTML =
	        'Thanks for logging in, ' + response.name + '!';
	    });
	  }

	</script>
  <script>
  var googleUser = {};
  var startApp = function() {
    gapi.load('auth2', function(){
      // Retrieve the singleton for the GoogleAuth library and set up the client.
      auth2 = gapi.auth2.init({
        client_id: '362699089953-rn4qv2qj9aosr1eic0tntpqhd0eo9q48.apps.googleusercontent.com',
        cookiepolicy: 'single_host_origin',
        // Request scopes in addition to 'profile' and 'email'
        //scope: 'additional_scope'
      });
      attachSignin(document.getElementById('customBtn'));
    });
  };

  function attachSignin(element) {
	    console.log(element.id);
	    auth2.attachClickHandler(element, {},
	        function(googleUser) {

	    	var profile = googleUser.getBasicProfile();
	        console.log("ID: " + profile.getId()); // Don't send this directly to your server!
	        console.log('Full Name: ' + profile.getName());
	        console.log('Given Name: ' + profile.getGivenName());
	        console.log('Family Name: ' + profile.getFamilyName());
	        console.log("Image URL: " + profile.getImageUrl());
	        console.log("Email: " + profile.getEmail());

	        // The ID token you need to pass to your backend:
	        var id_token = googleUser.getAuthResponse().id_token;
	        console.log("ID Token: " + id_token);
	        validateSocialMediaUser(profile);
	        //document.getElementById('c1').val( profile.getId );
	        //Realizar validacion a backend para verficar si existe en BD de ShingShing
	        
	          
              
	        }, function(error) {
	          alert(JSON.stringify(error, undefined, 2));
	        });
	  }

  	function validateSocialMediaUser(profile){
  		console.log(profile)
  		var url='http://www.shingshing.com/shin-back/usuarios/social/registrar';
  		$.ajax({
			method: "POST",
			url: 'http://www.shingshing.com/shin-back/usuarios/social/registrar',
		    dataType: "json",
            contentType: "application/json;charset=utf-8",
			data: JSON.stringify({ 
				'nombre': profile.name,
			  	'fechaNac': '1970-01-01',
			  	'correoElectronico': profile.email,
			  	'usuario':profile.email,
			  	'contrasenia': profile.email,
			  	'codigoPostal': '00000',
			  	'idCatalogoSexo': 3,
			  	'idRedSocial': 1
	  			}), success: function (response) {
                    
	                 console.log(response);
	                $('#username').val( response.usuario.correoElectronico );
	         		$('#password').val( response.usuario.correoElectronico );
	         		$('#LoginValidation').submit();
                 
            },
            error: function (error) {
                console.log(error)
            }
	})
		
	}

  </script>
  <!-- Imagenes -->
  <style type="text/css">
		#logo-header{
			background-image: url(../resources/home/img/brands/ss-complet.svg);
		}
		#pleca{
			background-image: url(../resources/home/img/micros/background.svg);
		}
		#footer #logo{
			background-image: url(../resources/home/img/brands/ss-complet-orange.svg);
		}
		#social #fb, .logo-fb{
			background-image: url(../resources/home/img/brands/fb.svg);
		}
		#social #tw{
			background-image: url(../resources/home/img/brands/tw.svg);
		}
		.logo-gm{
			background-image: url(../resources/home/img/brands/gm.svg);
		}
		.icon-mail{
			background-image: url(../resources/home/img/icon/mail.svg);
		}
		.icon-toggle{
			background-image: url(../resources/home/img/icon/toggle.svg);
		}
		.pico{
			background-image: url(../resources/home/img/icon/pico.svg);
		}
			@media (min-width: 768px) and (max-width: 991px) {
				#principal #imagen{
					background-image: url(../resources/home/img/micros/principal-tablet.png);
					margin-top: -40px;
				}
			}
  </style>
</head>

<body>
	<!-- Principal -->
	<div id="principal" class="section">

		<!-- Header -->
		<header>
			<div class="container">
				<a th:href="@{/portal-usuario}">
					<div class="row justify-content-between">
						<div class="col" id="logo-header"></div>
					</div>
				</a>
				</div>
		</header>

	</div>

	<div class="line-white -line"></div>

	<!-- Contenedor -->
	<div class="section">
		<!-- Content principal -->
		<div id="content-principal">
			<div class="container">
				<form id="LoginValidation" class="form" action="login" method="post"
					th:object="${item}">
					<div class="row justify-content-center">

						<div class="col-12">
							<div class="row justify-content-center">
								<div class="input-group mb-3 col-10 col-sm-8 col-md-6 col-lg-4">
									<div class="col">
										<label class="label-default col-12">Email / Teléfono</label> <input
											type="text" class="form-control input-grey col-12"
											placeholder="" th:field="*{username}" aria-label="Username"
											aria-describedby="basic-addon1" required="true" />
									</div>
								</div>
							</div>
						</div>

						<div class="col-12">
							<div class="row justify-content-center">
								<div class="input-group mb-3 col-10 col-sm-8 col-md-6 col-lg-4">
									<div class="col">
										<label class="label-default col-12">Contraseña</label> <input
											type="password" class="form-control input-grey col-12"
											placeholder="" th:field="*{password}" aria-label="Username"
											aria-describedby="basic-addon1" required="true" />
									</div>
								</div>
							</div>
						</div>

						<div class="col-12">
							<div class="row justify-content-center">
								<div class="alert alert-danger alert-dismissible fade show"
									role="alert" th:if="${param.error}">
									Email / Teléfono o contraseña incorrecta.
									<button type="button" class="close" data-dismiss="alert"
										aria-label="Close">
										<span aria-hidden="true">&times;</span>
									</button>
								</div>
							</div>
						</div>

						<div class="col-10 col-sm-8 col-md-6 col-lg-4">
							<div class="row justify-content-between">
								<div class="col">
									<div class="form-group form-check col">
										<input type="checkbox" class="form-check-input check-style"
											id="exampleCheck1" /> <label
											class="form-check-label checkbox-style" for="exampleCheck1">Recuérdame</label>
									</div>
								</div>
								<button type="submit" class="btn btn-primary cta-orange col">Iniciar
									Sesión</button>
							</div>
						</div>

					</div>
				</form>
			</div>
			
			<div class="container">
				<div class="row justify-content-center">
					<div class="col-10 col-sm-8 col-md-12 link-input-group" style="text-align: center;">
						<a th:href="@{/portal-usuario/restaurar/solicitar}">Olvide mi contraseña :(</a>
					</div>

					<div class="col-10 col-sm-8 col-md-8 col-lg-10 title-social-login">
						Inicia sesión con:
					</div>

					<div class="col-10 col-sm-8 col-md-6 col-lg-4">
						<div class="row justify-content-center">

							<div class="col-12 col-lg-4">
								<a href="#">
									<button class="btn-social-login bkg-fb" onclick="LoginFacebook()">
										<div class="row justify-content-center cont-fb">
											<div class="logo-fb col"></div>
											<div class="col fb-style">Facebook</div>
										</div>
									</button>
								</a>
							</div>

							<div class="col-12 col-lg-4 m-16-16">
								<button class="btn-social-login bkg-grey">
										<div id="customBtn" class="row justify-content-center cont-gm">
											<div class="logo-gm col"></div>
											<div class="col gm-style">Gmail</div>
										</div>
										<div id="name"></div>
									</button>
									<input type="hidden" id="c1" name="custId" value=""/>
									<input type="hidden" id="c2" name="custId" value=""/>
									<input type="hidden" id="c3" name="custId" value=""/>
									<input type="hidden" id="c4" name="custId" value=""/>
									<input type="hidden" id="c5" name="custId" value=""/>
									<input type="hidden" id="c6" name="custId" value=""/>
									<input type="hidden" id="c7" name="custId" value=""/>
									<input type="hidden" id="c8" name="custId" value=""/>
									<input type="hidden" id="c9" name="custId" value=""/>
									<input type="hidden" id="c10" name="custId" value=""/>
							</div>

							<div class="col-12 col-lg-4">
								<a th:href="@{/portal-usuario/restaurar/crear-cuenta}">
									<button class="btn-social-login bkg-grey">
										<div class="row justify-content-center cont-mail">
											<div class="icon-mail col"></div>
											<div class="col gm-style">Tu email</div>
										</div>
									</button>
								</a>
							</div>

						</div>
					</div>
					
					<!-- For test purpose 
					<fb:login-button scope="public_profile,email" onlogin="checkLoginState();">
						</fb:login-button>
					<button id = "idBtn">Trigger submit event</button>
					<div id="status">
					</div>
					<button id = "idBtn">Trigger submit event</button>
					 -->
					<div class="row justify-content-center">
						<div id="footer-login" class="col-10 col-lg-6">
							<div class="row justify-content-center">
								<div class="col-12 col-sm-8 col-md-12" style="text-align: center; font-size: 13px; color: #666; margin-top: 32px; border-top: solid 1px #ccc; padding-top: 16px;">
								Si haces clic en el logo de Facebook ó Google y no eres usuario de Shing Shing, quedarás registrado y aceptarás los <a th:href="@{/legal}">Términos y Condiciones y las Política de Privacidad</a> de Shing Shing.
								</div>
							</div>
						</div>	
					</div>
				</div>
			</div>
			
		</div>
	</div>

  <!-- Start your project here-->

  <!-- SCRIPTS -->

  <!-- JQuery -->
  <script type="text/javascript" th:src="@{/resources/home/js/jquery-3.4.1.min.js}"></script>
  <!-- Bootstrap tooltips -->
  <script type="text/javascript" th:src="@{/resources/home/js/popper.min.js}"></script>
  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" th:src="@{/resources/home/js/bootstrap.min.js}"></script>
  <!-- MDB core JavaScript -->
  <script type="text/javascript" th:src="@{/resources/home/js/mdb.min.js}"></script>
  <script th:src="@{/resources/assets/js/plugins/jquery.validate.min.js}"></script>
	<script type="text/javascript">

	
	var theToggle = document.getElementById('toggle');

	// based on Todd Motto functions
	// https://toddmotto.com/labs/reusable-js/

	// hasClass
	function hasClass(elem, className) {
		return new RegExp(' ' + className + ' ').test(' ' + elem.className + ' ');
	}
	// addClass
	function addClass(elem, className) {
	    if (!hasClass(elem, className)) {
	    	elem.className += ' ' + className;
	    }
	}
	// removeClass
	function removeClass(elem, className) {
		var newClass = ' ' + elem.className.replace( /[\t\r\n]/g, ' ') + ' ';
		if (hasClass(elem, className)) {
	        while (newClass.indexOf(' ' + className + ' ') >= 0 ) {
	            newClass = newClass.replace(' ' + className + ' ', ' ');
	        }
	        elem.className = newClass.replace(/^\s+|\s+$/g, '');
	    }
	}
	// toggleClass
	function toggleClass(elem, className) {
		var newClass = ' ' + elem.className.replace( /[\t\r\n]/g, " " ) + ' ';
	    if (hasClass(elem, className)) {
	        while (newClass.indexOf(" " + className + " ") >= 0 ) {
	            newClass = newClass.replace( " " + className + " " , " " );
	        }
	        elem.className = newClass.replace(/^\s+|\s+$/g, '');
	    } else {
	        elem.className += ' ' + className;
	    }
	}

	

	function setFormValidation(id) {
		$(id).validate({
			rules: {
				password: {
          			required: true,
          			minlength: 8
      			},
      			username:{
      				required: true,
          		}
  			}
	      });
	}

	$(document).ready(function() {
		setFormValidation('#LoginValidation');

		$('#LoginValidation').submit(function(){
			    
		});
			
		$('#idBtn').click(function(){
			    //$('#LoginValidation').submit();
			$.ajax({
					method: "POST",
					url: "http://localhost:8080/shin-back/usuarios/social/registrar",
				    dataType: "json",
		            contentType: "application/json;charset=utf-8",
					data: JSON.stringify({ 
						'nombre': 'Juan Osorio Alvarez',
					  	'fechaNac': '1970-01-01',
					  	'correoElectronico': 'kissthbw@gmail.com',
					  	'usuario':'kissthbw@gmail.com',
					  	'contrasenia': 'isaias53',
					  	'codigoPostal': '00000',
					  	'idCatalogoSexo': 3,
					  	'idRedSocial': 1
	  	  			})
			})
				.done(function( data ) {
					console.log( data.code );
					$('#username').val( data.usuario.usuario );
					$('#password').val( 'hash:' + data.usuario.hash );
					$('#LoginValidation').submit();
				});
		});  
	});

	

	  startApp();
	  
	theToggle.onclick = function() {
		   toggleClass(this, 'on');
		   return false;
		}

	</script> 



	</body>

	</html>
 <script th:src="@{/resources/assets/build/toastr.min.js}"></script>
<script th:replace="administrador/fragments/form-reporte-problema::script-reporte-problema"></script>
<script th:replace="administrador/fragments/toast::toast-config"></script>

